<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>J.A.R.V.I.S</title>
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';">

    <link rel="stylesheet" href="css/general.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body>
    <div class="container">
        <h1>JARVIS</h1>
        <h4>Version 1.0</h4>
        <p>Reconocimiento de voz</p>
        <main>
            <button id="button">Start listening</button>
            <div id="result"></div>
            <p id="message" hidden="" aria-hidden="true">
              Your browser doesn't support Speech Recognition. Sorry.
            </p>
          </main>
          <script>
            window.addEventListener("DOMContentLoaded", () => {
              const button = document.getElementById("button");
              const result = document.getElementById("result");
              const main = document.getElementsByTagName("main")[0];
              let listening = false;
              const SpeechRecognition =
                window.SpeechRecognition || window.webkitSpeechRecognition;
              if (typeof SpeechRecognition !== "undefined") {
                const recognition = new SpeechRecognition();
      
                const stop = () => {
                  main.classList.remove("speaking");
                  recognition.stop();
                  button.textContent = "Start listening";
                };
      
                const start = () => {
                  main.classList.add("speaking");
                  recognition.start();
                  button.textContent = "Stop listening";
                };
      
                const onResult = event => {
                  result.innerHTML = "";
                  for (const res of event.results) {
                    const text = document.createTextNode(res[0].transcript);
                    const p = document.createElement("p");
                    if (res.isFinal) {
                      p.classList.add("final");
                    }
                    p.appendChild(text);
                    result.appendChild(p);
                  }
                };
                recognition.continuous = true;
                recognition.interimResults = true;
                recognition.addEventListener("result", onResult);
                button.addEventListener("click", event => {
                  listening ? stop() : start();
                  listening = !listening;
                });
              } else {
                button.remove();
                const message = document.getElementById("message");
                message.removeAttribute("hidden");
                message.setAttribute("aria-hidden", "false");
              }
            });
          </script>
    </div>
    <script src="js/app.js"></script>
</body>
</html>